!function(e){function t(t){function n(){var t,n,i;return t=new Date,n=ytcrypto.md.sha256.create(),n.update(t),i=n.digest(),e.util.bytesToHex(i.data)}var i=t.util||{},o=t.webToken=t.webToken||{};o.servicePort=14461,o.language="kor",o.error={},o.error.NOT_LOAD=89496682,o.error.LOST_CONNECTION=33434461,o.FS=!1,o.status="not working",o.serverID="fjewlqljw",o.FSServerID="fstinelp76",o.FSFormID="ngjsp77q4",o.sessionID=""+n(),o.messageNumber=0,o.SecKeyVendor="",o.callbackPool={};var r=function(e){if("object"==typeof a&&null!=a)return void a(e);var n,r,d;if(o.FS===!0||void 0===window.postMessage){var f;f=document.getElementById(o.FSServerID),f&&f.parentNode.removeChild(f),f=document.getElementById(o.FSFormID),f&&f.parentNode.removeChild(f)}try{n=JSON.parse(e.data)}catch(c){throw"JSON.parse failed "+c+"\n"+e.data}if(n.resultCode==o.error.LOST_CONNECTION&&(o.status="unloaded"),d=o.callbackPool[n.messageNumber],"undefined"==typeof d)return void(console&&console.log("invalid webtoken response message"));if(delete o.callbackPool[n.messageNumber],0==n.resultCode)switch(n.operation){case"GetVersion":r=n.list;break;case"GetTokenList":r=n.list;break;case"GetCertificateList":r=n.list;break;case"GetCertificate":var p;return p=i.decode64(n.certificate),void t.pki.Certificate.fromBytes(p,function(e){var t={};t.cert=e,"undefined"!=typeof n.path&&(t.path=n.path),d(t)});case"GetCACertificate":r=n;break;case"GenerateSignature":if(r={},"[object Array]"===Object.prototype.toString.call(n.signature)){for(r.signature=[];n.signature.length>0;)r.signature.push(i.decode64(n.signature.shift()))}else r.signature=i.decode64(n.signature);"undefined"!=typeof n.encryptedVIDRandom&&(r.encryptedVIDRandom=i.decode64(n.encryptedVIDRandom)),"undefined"!=typeof n.dn&&(r.dn=i.decode64(n.dn)),"undefined"!=typeof n.r&&(r.r=i.decode64(n.r)),"undefined"!=typeof n.certificate&&(r.certificate=i.decode64(n.certificate));break;case"VerifySignature":r=n;break;case"GenerateKeyPair":r={},r.publicKey=i.decode64(n.publicKey),r.keyIdentifier=n.keyIdentifier;break;case"PushCertificate":r=n;break;case"DeleteCertificate":r=n;break;case"EncryptVIDRandom":r={},r.encryptedVIDRandom=i.decode64(n.encryptedVIDRandom);break;case"SetTokenOptions":r=n;break;case"IssueCertificate":r=n;break;case"UpdateCertificate":r=n;break;case"RevokeCertificate":r=n;break;case"RecoverCertificate":r=n;break;case"GetPCIdentityInfo":r=n;break;case"GetMacAddress":r=n;break;case"ChangePin":r=n;break;case"VerifyPin":r=n;break;case"VerifyVID":r=n;break;case"ImportCertificate":r=n;break;case"ExportCertificate":r=n;break;case"ChangeStorage":r=n;break;case"ValidateCertificate":r=n;break;case"SetMatchedContext":r={},r.hasSession=n.hasSession,r.list=n.list;break;case"UnsetMatchedContext":r=n;break;case"MakeCustomSession":r=n;break;case"OperateTray":r=n;break;case"GetE2EInfo":r=n;break;case"GetHash":r=n;break;case"Encrypt":r=n;break;case"Decrypt":r=n;break;case"Envelope":r=n;break;case"Deenvelope":r=n;break;case"SetLocale":r=n;break;case"Relay.Raon.GetRefNum":r=n;break;case"Relay.Raon.GetCert":r=n;break;case"Relay.Raon.ExportCert":r=n;break;case"SetConfigFile":r=n;break;default:r=new t.error("not supported operation:"+n.operation)}else r=new t.error(n.resultCode,"get error code:"+n.resultCode+" reason:"+n.resultMessage);d(r)};o.callRPC=function(e,n,a){var d,f;o.load(function(c){function p(e){var n,a,d={};n=document.getElementById(o.FSServerID);try{a=n.contentWindow.name}catch(f){throw f}try{d.data=i.decodeUTF8(i.decode64(a))}catch(c){return void t.console.log(a)}r(d)}if(!c)return void n(new t.error(o.error.NOT_LOAD,"webtoken was not loaded"));e.language=o.language,e.sessionID=o.sessionID,e.messageNumber=o.messageNumber,e.SecKeyVendor=o.SecKeyVendor,e.manager=a,o.messageNumber++,o.callbackPool[e.messageNumber]=n,d=document.getElementById(o.serverID);var s;s=JSON.stringify(e);var u="https://127.0.0.1:"+o.servicePort,l=u+"/TIC";if(f="undefined"==typeof a?u+"/VestCert/MangoFS.jsp":u+"/VestCert/"+a+"/MangoFS.jsp",o.FS===!0||"undefined"==typeof window.postMessage){var y,C,g,m,v;if(-1!=navigator.userAgent.indexOf("MSIE 7.0")){var I="";I+="<iframe ",I+='id="'+o.FSServerID+'"',I+='name="'+o.FSServerID+'"',I+='src="'+l+'"',I+=" />",y=document.createElement(I),I="<form ",I+='id="'+o.FSFormID+'" ',I+='action="'+f+'" ',I+='method="post"',I+='target="'+o.FSServerID+'"',I+=" >",I+="</form>",C=document.createElement(I)}else y=document.createElement("iframe"),y.setAttribute("id",o.FSServerID),y.setAttribute("name",o.FSServerID),y.setAttribute("src",l),C=document.createElement("form"),C.setAttribute("id",o.FSFormID),C.setAttribute("action",f),C.setAttribute("method","post"),C.setAttribute("target",o.FSServerID);y.style.display="none",t.common.addEvent(y,"load",p),document.body.appendChild(y),C.style.display="none",document.body.appendChild(C),g=document.createElement("input"),g.setAttribute("name","message"),g.value=i.bytesToHex(i.encodeUTF8(s)),m=document.createElement("input"),m.setAttribute("name","returnURL"),v=location.href,m.value=i.bytesToHex(i.encodeUTF8(v)),C.appendChild(g),C.appendChild(m),C.submit()}else d.contentWindow.postMessage(s,"https://127.0.0.1:"+o.servicePort)})},o.setLanguage=function(e){o.language=e},o.getVersion=function(e,t){var n={};n.operation="GetVersion","string"==typeof moduleNames&&(n.module=e),o.callRPC(n,t)},o.getTokenList=function(e){var t={};t.operation="GetTokenList",o.callRPC(t,e)},o.getCertificateList=function(e,t,n,i){var r={};r.operation="GetCertificateList",r.tokenIdentifier=e,"undefined"!=typeof t&&(r.filter=t),"undefined"!=typeof n&&(r.options=n),o.callRPC(r,i)},o.getCertificate=function(e,t,n){var i={};i.operation="GetCertificate",i.tokenIdentifier=e,i.certIdentifier=t,o.callRPC(i,n)},o.getCACertificate=function(e,t,n){var i={};i.operation="GetCACertificate",i.tokenIdentifier=e,i.certIdentifier=t,o.callRPC(i,n)},o.generateSignature=function(e,t,n,r,a,d,f){var c={};if(c.operation="GenerateSignature",c.tokenIdentifier=e,"undefined"!=typeof t&&(c.pin=t),"undefined"!=typeof n&&(c.certIdentifier=n),"undefined"!=typeof r&&(c.keyIdentifier=r),"[object Array]"===Object.prototype.toString.call(a)){for(c.plain=[];a.length>0;)c.plain.push(i.encode64(a.shift()))}else c.plain=i.encode64(a);"undefined"!=typeof d&&(c.options=d),o.callRPC(c,f)},o.verifySignature=function(e,t,n,r){var a={};if(a.operation="VerifySignature","undefined"!=typeof pin&&(a.pin=pin),"string"==typeof e&&(a.signature=e),"undefined"!=typeof t&&(a.params=t,"undefined"!=typeof t.plain))if("[object Array]"===Object.prototype.toString.call(t.plain))for(a.params.plain=[];t.plain.length>0;)a.params.plain.push(i.encode64(t.plain.shift()));else a.params.plain=i.encode64(t.plain);"undefined"!=typeof n&&(a.options=n),o.callRPC(a,r)},o.generateKeyPair=function(e,n,i,r,a,d){var f={};f.operation="GenerateKeyPair",f.tokenIdentifier=e,f.algorithm="RSA",f.modularLength=r,"undefined"!=typeof n&&(f.pin=n),"undefined"!=typeof a&&(f.purpose=a),o.callRPC(f,function(i){if(i instanceof t.error)return i.pushReason("webTokenRPC failed"),void d(i);var r={};t.crypto.key.fromBytes(i.publicKey,function(a){return a instanceof t.error?(a.pushReason("instantiate publickey  from bytes failed"),void d(a)):(r.publicKey=a,r.privateKey=o.toPrivateKey(e,n,i.keyIdentifier),void d(r))})})},o.pushCertificate=function(e,t,n,r,a,d){var f={};f.operation="PushCertificate",f.tokenIdentifier=e,"undefined"!=typeof t&&(f.pin=t),"string"==typeof n?f.certificate=n:f.certificate=i.encode64(n.toAsn1().toBytes()),f.keyIdentifier=r,"undefined"!=typeof a&&(f.random=a),o.callRPC(f,d)},o.deleteCertificate=function(e,t,n,i,r){var a={};a.operation="DeleteCertificate","undefined"!=typeof t&&(a.pin=t),a.tokenIdentifier=e,a.certIdentifier=n,a.keyIdentifier=i,o.callRPC(a,r)},o.encryptVIDRandom=function(e,t,n,r,a){var d={};d.operation="EncryptVIDRandom","undefined"!=typeof t&&(d.pin=t),d.tokenIdentifier=e,d.keyIdentifier=n,"string"==typeof r?d.recipientCertificate=r:d.recipientCertificate=i.encode64(r.toAsn1().toBytes()),o.callRPC(d,a)},o.setTokenOptions=function(e,t,n){var i={};i.operation="SetTokenOptions",i.tokenIdentifier=e,i.options=t,o.callRPC(i,n)},o.CAType={},o.CAType.yessign="yessign",o.CAType.crossCert="crossCert",o.CAType.signKorea="signKorea",o.issueCertificate=function(e,t,n,i,r,a,d){var f={};f.operation="IssueCertificate",f.tokenIdentifier=e,f.CAType=t,f.referenceNumber=n,f.authenticationCode=i,"undefined"!=typeof r&&(f.pin=r),f.options={},a&&(a.CAServiceIP&&(f.options.CAServiceIP=a.CAServiceIP),a.CAServicePort&&(f.options.CAServicePort=a.CAServicePort),a.center&&(f.options.center=a.center),a.isBill&&(f.options.isBill=a.isBill)),o.callRPC(f,d)},o.updateCertificate=function(e,t,n,i,r,a,d,f,c){var p={};p.operation="UpdateCertificate",p.tokenIdentifier=e,p.CAType=i,p.oldCertIdentifier=t,p.oldKeyIdentifier=n,p.options=f,"undefined"!=typeof r&&(p.pin=r),"undefined"!=typeof a&&(p.newpin=a),"undefined"!=typeof d&&(p.reusePin=d),o.callRPC(p,c)},o.revokeCertificate=function(e,t,n,i,r,a,d){var f={};f.operation="RevokeCertificate",f.tokenIdentifier=e,f.CAType=i,f.certIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof r&&(f.pin=r),f.options=a,o.callRPC(f,d)},o.recoverCertificate=function(e,t,n,i,r,a,d){var f={};f.operation="RecoverCertificate",f.tokenIdentifier=e,f.CAType=t,f.referenceNumber=n,f.authenticationCode=i,"undefined"!=typeof r&&(f.pin=r),f.options={},a&&(a.CAServiceIP&&(f.options.CAServiceIP=a.CAServiceIP),a.CAServicePort&&(f.options.CAServicePort=a.CAServicePort),a.center&&(f.options.center=a.center)),o.callRPC(f,d)},o.setMatchedContext=function(e,t,n,i,r,a,d){var f={};f.operation="SetMatchedContext","undefined"!=typeof e&&(f.customSID=e),"undefined"!=typeof t&&(f.pin=t),"undefined"!=typeof n&&(f.dn=n),"undefined"!=typeof i&&(f.suffix=i),"undefined"!=typeof r&&(f.type=r),"undefined"!=typeof a&&(f.options=a),o.callRPC(f,d)},o.unsetMatchedContext=function(e,t){var n={};n.operation="UnsetMatchedContext","undefined"!=typeof e&&(n.customSID=e),o.callRPC(n,t)},o.makeCustomSession=function(e,t,n,i,r,a){var d={};d.operation="MakeCustomSession","undefined"!=typeof e&&(d.customSID=e),"undefined"!=typeof t&&(d.tokenIdentifier=t),"undefined"!=typeof n&&(d.certIdentifier=n),"undefined"!=typeof i&&(d.keyIdentifier=i),"undefined"!=typeof r&&(d.pin=r),o.callRPC(d,a)},o.envelope=function(e,t,n,r,a,d,f){var c={};c.operation="Envelope","undefined"!=typeof e&&(c.tokenIdentifier=e),"undefined"!=typeof t&&(c.certificate=t),"undefined"!=typeof n&&(c.certIdentifier=n),"undefined"!=typeof r&&(c.plain=i.encode64(r)),"undefined"!=typeof a&&(c.outputfile=a),"undefined"!=typeof d&&(c.options=d),o.callRPC(c,f)},o.deenvelope=function(e,t,n,i,r,a){var d={};d.operation="Deenvelope","undefined"!=typeof e&&(d.tokenIdentifier=e),"undefined"!=typeof t&&(d.keyIdentifier=t),"string"==typeof n&&(d.envelopedMsg=n),"undefined"!=typeof i&&(d.outputfile=i),"undefined"!=typeof r&&(d.options=r),o.callRPC(d,a)},o.getPCIdentityInfo=function(e,t,n){var i={};i.operation="GetPCIdentityInfo",i.mode=e,i.input=t,o.callRPC(i,n,"Manager")},o.getMacAddress=function(e,t){var n={};n.operation="GetMacAddress",n.mode=e,o.callRPC(n,t,"Manager")},o.changePin=function(e,t,n,i,r,a,d){var f={};f.operation="ChangePin",f.tokenIdentifier=e,f.certIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof i&&(f.oldPin=i),"undefined"!=typeof r&&(f.newPin=r),"undefined"!=typeof a&&(f.options=a),o.callRPC(f,d,"Manager")},o.verifyPin=function(e,t,n,i){var r={};r.operation="VerifyPin",r.tokenIdentifier=e,r.keyIdentifier=t,"undefined"!=typeof n&&(r.pin=n),o.callRPC(r,i,"Manager")},o.verifyVID=function(e,t,n,i,r,a){var d={};d.operation="VerifyVID",d.tokenIdentifier=e,d.certIdentifier=t,d.keyIdentifier=n,d.idn=r,"undefined"!=typeof i&&(d.pin=i),o.callRPC(d,a,"Manager")},o.importCertificate=function(e,t,n,i,r){var a={};a.operation="ImportCertificate",a.tokenIdentifier=e,"undefined"!=typeof t&&(a=t),"undefined"!=typeof n&&(a.reusePin=n),"undefined"!=typeof i&&(a.options=i),o.callRPC(a,r,"Manager")},o.exportCertificate=function(e,t,n,i,r,a,d){var f={};f.operation="ExportCertificate",f.tokenIdentifier=e,f.certIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof i&&(f.pin=i),"undefined"!=typeof r&&(f.reusePin=r),"undefined"!=typeof a&&(f.options=a),o.callRPC(f,d,"Manager")},o.relayRaonGetRefNum=function(e,t,n,i){var r={};r.operation="Relay.Raon.GetRefNum",r.tokenIdentifier=e,r.siteCode=t,n&&(r.options={},n.relayIP&&(r.options.relayIP=n.relayIP),n.relayPort&&(r.options.relayPort=n.relayPort),n.supportKm&&(r.options.supportKm=n.supportKm)),o.callRPC(r,i,"Manager")},o.relayRaonGetCert=function(e,t,n,i){var r={};r.operation="Relay.Raon.GetCert",r.tokenIdentifier=e,r.siteCode=t,n&&(r.options={},n.relayIP&&(r.options.relayIP=n.relayIP),n.relayPort&&(r.options.relayPort=n.relayPort),n.supportKm&&(r.options.supportKm=n.supportKm)),o.callRPC(r,i,"Manager")},o.relayRaonExportCert=function(e,t,n,i,r,a,d,f,c){var p={};p.operation="Relay.Raon.ExportCert",p.tokenIdentifier=e,p.certIdentifier=t,p.keyIdentifier=n,p.kmCertIdentifier=i,p.kmKeyIdentifier=r,p.refNum=d,f&&(p.options={},f.relayIP&&(p.options.relayIP=f.relayIP),f.relayPort&&(p.options.relayPort=f.relayPort),f.supportKm&&(p.options.supportKm=f.supportKm),f.deleteCert&&(p.options.deleteCert=f.deleteCert)),"undefined"!=typeof a&&(p.pin=a),o.callRPC(p,c,"Manager")},o.changeStorage=function(e,t,n,i,r,a,d){var f={};f.operation="ChangeStorage",f.tokenIdentifier=e,f.newTokenIdentifier=t,f.certIdentifier=n,f.keyIdentifier=i,f.deleteCert=r,"undefined"!=typeof a&&(f.pin=a),o.callRPC(f,d,"Manager")},o.ValidateCertificate=function(e,t,n,i){var r={};r.operation="ValidateCertificate",r.tokenIdentifier=e,r.certIdentifier=t,"undefined"!=typeof n&&(r.mode=n),o.callRPC(r,i,"Manager")},o.operateTray=function(e,t,n,i){var r={};r.operation="OperateTray",r.vendor=e,r.operate=t,"undefined"!=typeof n&&(r.options=n),o.callRPC(r,i,"Manager")},o.getE2EInfo=function(e,t){var n={};n.operation="GetE2EInfo",n.vendor=e,o.callRPC(n,t,"Manager")},o.setLocale=function(e,t){var n={};n.operation="SetLocale",n.locale=e,o.callRPC(n,t,"Manager")},o.getHash=function(e,t,n,r){var a={};a.operation="GetHash","undefined"!=typeof e&&(a.plainType=e),"undefined"!=typeof t&&(a.plain=i.encode64(t)),"undefined"!=typeof n&&(a.mode=n),o.callRPC(a,r,"Cipher")},o.encrypt=function(e,t,n,r){var a={};a.operation="Encrypt","undefined"!=typeof e&&(a.plain=i.encode64(e)),a.args={},"undefined"!=typeof t&&("undefined"!=typeof t.algorithm&&(a.args.algorithm=t.algorithm),"undefined"!=typeof t.mode&&(a.args.mode=t.mode),"undefined"!=typeof t.padding&&(a.args.padding=t.padding)),a.keys={},"undefined"!=typeof n&&("undefined"!=typeof n.key&&(a.keys.key=i.encode64(n.key)),"undefined"!=typeof n.iv&&(a.keys.iv=i.encode64(n.iv))),o.callRPC(a,r,"Cipher")},o.decrypt=function(e,t,n,r){var a={};a.operation="Decrypt","string"==typeof e&&(a.encMsg=e),a.args={},"undefined"!=typeof t&&("undefined"!=typeof t.algorithm&&(a.args.algorithm=t.algorithm),"undefined"!=typeof t.mode&&(a.args.mode=t.mode),"undefined"!=typeof t.padding&&(a.args.padding=t.padding)),a.keys={},"undefined"!=typeof n&&("undefined"!=typeof n.key&&(a.keys.key=i.encode64(n.key)),"undefined"!=typeof n.iv&&(a.keys.iv=i.encode64(n.iv))),o.callRPC(a,r,"Cipher")},o.toPrivateKey=function(e,n,i){var r;return r=new t.crypto.key,r.tokenIdentifier=e,r.keyIdentifier=i,r.sign=function(e,i,a){o.generateSignature(r.tokenIdentifier,n,void 0,r.keyIdentifier,i,{},function(e){return e instanceof t.error?(e.pushReason("webToken generateSiganture failed"),void a(e)):void a(e.signature)})},r._export=function(){throw"not supported"},r},o.setConfigFile=function(e,t){var n={};n.operation="SetConfigFile",n.config=e,o.callRPC(n,t,"Manager")},o.unLoad=function(){var e;"ready"===o.status&&(e=document.getElementById(o.serverID),"undefined"!=typeof e&&(e.parentNode.removeChild(e),o.status="not working"))},o.load=function(e){function n(n){e?e(!1):t.console.log("img load fail")}if("ready"===o.status)return void(e&&e(!0));t.console.log("try load");var i,r,a,d,f;a=o.servicePort,d="https://127.0.0.1:"+a+"/",f="https://127.0.0.1:"+a+"/TIC",f+="?"+(new Date).getTime(),i=document.createElement("iframe"),i.id=o.serverID;var c=function(t){o.status="ready",e&&e(!0)};t.common.addEvent(i,"load",c),i.style.display="none",i.src=d,r=document.createElement("img"),t.common.addEvent(r,"error",n);var p=function(e){delete r,document.body.appendChild(i),o.status="loading"};t.common.addEvent(r,"load",p),r.src=f};var a=window.onmessage;window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent?window.attachEvent("onmessage",r):(window.onmessage=r,t.console.log("unknown addevent method"))}return t(e)}(yt);